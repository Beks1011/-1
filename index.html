<!doctype html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ 1-11 –∫–ª–∞—Å—Å—ã</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
body { box-sizing: border-box; margin:0; background: linear-gradient(to bottom right,#e0f2fe,#c7d2fe);}
.time-container {
  position: fixed; top: 20px; right: 20px; text-align: center; color: #111827;
  z-index: 1000; background-color: rgba(255,255,255,0.85); padding: 8px 12px; border-radius: 8px;
  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
#clock { font-size:1.8rem; font-weight:bold;}
#date { font-size:1.2rem; font-weight:bold; color:#374151;}

.arrow { position: fixed; top:50%; transform:translateY(-50%); font-size:3rem; color:rgba(0,0,0,0.5); cursor:pointer; z-index:1000; user-select:none;}
.arrow:hover { color: rgba(0,0,0,0.8);}
.left-arrow { left:10px;} .right-arrow{right:10px;}

#schedule-container { position: relative; overflow:hidden; min-height:700px;}
.schedule-pages-wrapper { display:flex; transition: transform 0.8s ease; width:100%;}
.schedule-page { min-width:100%; box-sizing:border-box;}
td[contenteditable="true"] { text-align:center; vertical-align:middle; color:#000; background:#fff; }
td[contenteditable="true"] span { display:block; text-align:center; font-size:0.8rem; color:#000;}
.locked td[contenteditable="true"] { background:#e0e7ff; cursor:default;}
.lock-icon { margin-left:5px; color:#f87171; }
</style>
</head>
<body>

<div class="time-container">
  <div id="clock">00:00:00</div>
  <div id="date">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫, 1 —è–Ω–≤–∞—Ä—è 2025</div>
</div>

<div class="arrow left-arrow" id="prevPage">&#8592;</div>
<div class="arrow right-arrow" id="nextPage">&#8594;</div>

<div class="max-w-7xl mx-auto p-8">
  <h1 class="text-4xl font-bold text-center mb-4 text-gray-800">
    –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ 1-11 –∫–ª–∞—Å—Å—ã <span class="lock-icon" id="lockIcon">üîì</span>
  </h1>
  <div class="text-center mb-4">
    <button id="resetBtn" class="bg-red-600 text-white px-4 py-2 rounded hover:bg-red-700">–°–±—Ä–æ—Å–∏—Ç—å</button>
    <button id="saveBtn" class="bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
    <button id="toggleLockBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700">–í–∫–ª/–í—ã–∫–ª —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ</button>
  </div>
  <div id="schedule-container">
    <div class="schedule-pages-wrapper" id="pagesWrapper"></div>
  </div>
</div>

<!-- Firebase -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
import { getDatabase, ref, onValue, set } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyB2uI4kWwca1-wz3Knrko8eVkSOuPMxby8",
  authDomain: "schedule-8abc5.firebaseapp.com",
  databaseURL: "https://schedule-8abc5-default-rtdb.firebaseio.com",
  projectId: "schedule-8abc5",
  storageBucket: "schedule-8abc5.appspot.com",
  messagingSenderId: "158778787396",
  appId: "1:158778787396:web:bab4216617044c17665e11",
  measurementId: "G-WDCDG542WQ"
};

const app = initializeApp(firebaseConfig);
const db = getDatabase(app);

// ===== –ß–∞—Å—ã =====
function updateClock() {
  const now = new Date();
  const h = String(now.getHours()).padStart(2,'0');
  const m = String(now.getMinutes()).padStart(2,'0');
  const s = String(now.getSeconds()).padStart(2,'0');
  document.getElementById('clock').textContent = `${h}:${m}:${s}`;
  const days = ["–í–æ—Å–∫—Ä–µ—Å–µ–Ω—å–µ","–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫","–í—Ç–æ—Ä–Ω–∏–∫","–°—Ä–µ–¥–∞","–ß–µ—Ç–≤–µ—Ä–≥","–ü—è—Ç–Ω–∏—Ü–∞","–°—É–±–±–æ—Ç–∞"];
  const months = ["—è–Ω–≤–∞—Ä—è","—Ñ–µ–≤—Ä–∞–ª—è","–º–∞—Ä—Ç–∞","–∞–ø—Ä–µ–ª—è","–º–∞—è","–∏—é–Ω—è","–∏—é–ª—è","–∞–≤–≥—É—Å—Ç–∞","—Å–µ–Ω—Ç—è–±—Ä—è","–æ–∫—Ç—è–±—Ä—è","–Ω–æ—è–±—Ä—è","–¥–µ–∫–∞–±—Ä—è"];
  document.getElementById('date').textContent = `${days[now.getDay()]}, ${now.getDate()} ${months[now.getMonth()]} ${now.getFullYear()}`;
}
setInterval(updateClock,1000); updateClock();

// ===== –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ =====
const pagesWrapper = document.getElementById('pagesWrapper');
let currentPage=0; let pages=[];
const classLetters=["–ê","–ë","–í","–ì","–î"];
const allClasses=[];
for(let i=1;i<=11;i++){ classLetters.forEach(l=>allClasses.push(i+l)); }

let scheduleData={}; let isLocked=false;

// –ó–∞–≥—Ä—É–∑–∫–∞ —Å Firebase
const scheduleRef = ref(db, '/schedule');
onValue(scheduleRef, (snapshot)=>{
  scheduleData = snapshot.val() || {};
  generateSchedulePages();
});

// –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Å—Ç—Ä–∞–Ω–∏—Ü
function generateSchedulePages(){
  pagesWrapper.innerHTML=""; pages=[];
  for(let i=0;i<allClasses.length;i+=3){
    const pageDiv=document.createElement("div"); pageDiv.className="schedule-page";
    const pageClasses = allClasses.slice(i,i+3);
    pageClasses.forEach(cls=>{
      if(!scheduleData[cls]) scheduleData[cls] = {"–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫":[],"–í—Ç–æ—Ä–Ω–∏–∫":[],"–°—Ä–µ–¥–∞":[],"–ß–µ—Ç–≤–µ—Ä–≥":[],"–ü—è—Ç–Ω–∏—Ü–∞":[]};
      for(const day in scheduleData[cls]){
        while(scheduleData[cls][day].length<8) scheduleData[cls][day].push({subject:"",room:""});
      }
      let html=`<h2 class="text-2xl font-bold my-2">${cls}</h2>
      <table class="w-full border-collapse mb-8 bg-white rounded-lg shadow-lg overflow-hidden ${isLocked?"locked":""}">
        <thead><tr class="bg-gray-900 text-white">
        <th class="border px-4 py-2">‚Ññ</th>
        <th class="border px-4 py-2">–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫</th>
        <th class="border px-4 py-2">–í—Ç–æ—Ä–Ω–∏–∫</th>
        <th class="border px-4 py-2">–°—Ä–µ–¥–∞</th>
        <th class="border px-4 py-2">–ß–µ—Ç–≤–µ—Ä–≥</th>
        <th class="border px-4 py-2">–ü—è—Ç–Ω–∏—Ü–∞</th></tr></thead><tbody>`;
      for(let j=0;j<8;j++){
        html+="<tr>";
        html+=`<td class="border px-2 py-1 text-center">${j+1}</td>`;
        ["–ü–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫","–í—Ç–æ—Ä–Ω–∏–∫","–°—Ä–µ–¥–∞","–ß–µ—Ç–≤–µ—Ä–≥","–ü—è—Ç–Ω–∏—Ü–∞"].forEach(day=>{
          const lesson=scheduleData[cls][day][j];
          html+=`<td class="border px-2 py-1" contenteditable="${!isLocked}" data-class="${cls}" data-day="${day}" data-lesson="${j}">
                  ${lesson.subject}<br><span>${lesson.room}</span></td>`;
        });
        html+="</tr>";
      }
      html+="</tbody></table>";
      pageDiv.innerHTML+=html;
    });
    pagesWrapper.appendChild(pageDiv); pages.push(pageDiv);
  }
  updateSlider();
}

function updateSlider(){ pagesWrapper.style.transform = `translateX(${-currentPage*100}%)`; }
function showPage(index){ currentPage=(index+pages.length)%pages.length; updateSlider(); }

// –ù–∞–≤–∏–≥–∞—Ü–∏—è
document.getElementById('prevPage').addEventListener('click',()=>showPage(currentPage-1));
document.getElementById('nextPage').addEventListener('click',()=>showPage(currentPage+1));

// –ê–≤—Ç–æ–ø—Ä–æ–∫—Ä—É—Ç–∫–∞
setInterval(()=>showPage(currentPage+1),15000);

// –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Firebase
pagesWrapper.addEventListener('input',e=>{
  if(isLocked) return;
  const td = e.target.closest('td'); if(!td) return;
  const cls = td.dataset.class, day = td.dataset.day, lesson = td.dataset.lesson;
  const lines = td.innerHTML.split("<br>");
  scheduleData[cls][day][lesson]={subject:lines[0]?.trim()||"", room:lines[1]?.trim()||""};
  set(scheduleRef, scheduleData);
});

// –ö–Ω–æ–ø–∫–∏
document.getElementById('resetBtn').addEventListener('click',()=>{
  if(confirm("–í—ã —Ç–æ—á–Ω–æ —Ö–æ—Ç–∏—Ç–µ —Å–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ —É—Ä–æ–∫–∏?")){
    allClasses.forEach(cls=>{
      for(const day in scheduleData[cls]){
        scheduleData[cls][day]=Array.from({length:8},()=>({subject:"",room:""}));
      }
    });
    set(scheduleRef, scheduleData);
  }
});
document.getElementById('saveBtn').addEventListener('click',()=>{ set(scheduleRef,scheduleData); alert("–°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!"); });
document.getElementById('toggleLockBtn').addEventListener('click',()=>{ isLocked=!isLocked; document.getElementById('lockIcon').textContent=isLocked?"üîí":"üîì"; generateSchedulePages(); });

</script>
</body>
</html>
